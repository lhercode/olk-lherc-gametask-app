<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ .Site.Title }}</title>
    <link rel="icon" type="image/svg+xml" href="{{ "favicon.svg" | relURL }}">
    <link rel="manifest" href="{{ "manifest.json" | relURL }}">
    <link rel="stylesheet" href="{{ "css/style.css" | relURL }}">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <meta name="theme-color" content="#6c63ff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="TaskQuest">
    <meta name="apple-touch-fullscreen" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="msapplication-TileColor" content="#6c63ff">
    <meta name="msapplication-tap-highlight" content="no">
    
    <!-- Apple Touch Icons para iPhone -->
    <link rel="apple-touch-icon" href="/favicon.svg">
    <link rel="apple-touch-icon" sizes="180x180" href="/favicon.svg">
    <link rel="apple-touch-icon" sizes="167x167" href="/favicon.svg">
    <link rel="apple-touch-icon" sizes="152x152" href="/favicon.svg">
    <link rel="apple-touch-icon" sizes="120x120" href="/favicon.svg">
</head>
<body>
    <div class="container">
        
        <!-- Header con estad√≠sticas -->
        <header class="header">
            <div class="logo">
                <span class="logo-icon">üéÆ</span>
                <h1>TaskQuest</h1>
            </div>
            <div class="stats">
                <div class="stat-item">
                    <span class="stat-icon">üî•</span>
                    <div>
                        <div class="stat-value" id="streak">0</div>
                        <div class="stat-label">Racha</div>
                    </div>
                </div>
                <div class="stat-item">
                    <span class="stat-icon">‚≠ê</span>
                    <div>
                        <div class="stat-value" id="points">0</div>
                        <div class="stat-label">Puntos</div>
                    </div>
                </div>
                <div class="stat-item">
                    <span class="stat-icon">üèÜ</span>
                    <div>
                        <div class="stat-value" id="level">1</div>
                        <div class="stat-label">Nivel</div>
                    </div>
                </div>
                <div class="stat-item">
                    <span class="stat-icon">üìä</span>
                    <div>
                        <div class="stat-value performance-grade" id="performanceGrade">B</div>
                        <div class="stat-label">Rendimiento</div>
                    </div>
                </div>
            </div>
            
            <!-- Rest Alert System integrado en header -->
            <div class="rest-alert-compact">
                <div class="rest-alert-header">
                    <div class="rest-icon-container">
                        <span class="rest-icon" id="restIcon">üò¥</span>
                        <div class="rest-pulse" id="restPulse"></div>
                    </div>
                    <div class="rest-info">
                        <span class="rest-status" id="restStatus">Bueno</span>
                        <span class="rest-time" id="restTime">√öltimo descanso: hace 2h</span>
                    </div>
                </div>
                <div class="rest-thermometer-compact">
                    <div class="thermometer-track-compact">
                        <div class="thermometer-fill" id="restThermometerFill"></div>
                        <div class="thermometer-glow" id="restThermometerGlow"></div>
                    </div>
                    <div class="thermometer-labels-compact">
                        <span class="thermometer-label-compact">Agotado</span>
                        <span class="thermometer-label-compact">Excelente</span>
                    </div>
                </div>
                <div class="rest-actions-compact">
                    <button class="rest-btn-compact primary" id="takeBreakBtn" onclick="takeBreak()" title="Tomar Descanso">
                        <span class="btn-icon">‚òï</span>
                        <span class="btn-text">Descansar</span>
                    </button>
                    <button class="rest-btn-compact secondary" id="logRestBtn" onclick="logRest()" title="Registrar Descanso">
                        <span class="btn-icon">üìù</span>
                        <span class="btn-text">Registrar</span>
                    </button>
                </div>
            </div>
        </header>

        <!-- Barra de progreso de nivel -->
        <div class="level-progress">
            <div class="progress-bar">
                <div class="progress-fill" id="levelProgress"></div>
            </div>
            <p class="progress-text"><span id="currentPoints">0</span> / <span id="nextLevelPoints">100</span> XP</p>
        </div>

        <!-- Mensaje motivacional -->
        <div class="motivation-banner" id="motivationBanner">
            <span class="motivation-icon">üí™</span>
            <p id="motivationText">¬°Completa tu primera tarea del d√≠a!</p>
        </div>

        <!-- Navegaci√≥n de secciones -->
        <nav class="section-nav">
            <button class="nav-btn active" onclick="scrollToSection('categories')" data-section="categories">
                <span class="nav-icon">üìã</span>
                <span class="nav-text">Tareas</span>
            </button>
            <button class="nav-btn" onclick="scrollToSection('block-time')" data-section="block-time">
                <span class="nav-icon">‚è∞</span>
                <span class="nav-text">Block Time</span>
            </button>
            <button class="nav-btn" onclick="scrollToSection('daily-stats')" data-section="daily-stats">
                <span class="nav-icon">üìä</span>
                <span class="nav-text">Estad√≠sticas</span>
            </button>
            <button class="nav-btn" onclick="scrollToSection('stats-history')" data-section="stats-history">
                <span class="nav-icon">üìà</span>
                <span class="nav-text">Hist√≥rico</span>
            </button>
            <button class="nav-btn" onclick="scrollToSection('history')" data-section="history">
                <span class="nav-icon">üìã</span>
                <span class="nav-text">Historial</span>
            </button>
            <button class="nav-btn" onclick="scrollToSection('goals')" data-section="goals">
                <span class="nav-icon">üéØ</span>
                <span class="nav-text">Metas</span>
            </button>
        </nav>

        <!-- Categor√≠as de tareas -->
        <div class="categories" id="categories">
            <div class="category" data-category="comunicacion">
                <div class="category-header">
                    <span class="category-icon">üí¨</span>
                    <h2>Comunicaci√≥n</h2>
                    <span class="category-progress" id="progress-comunicacion">0/3</span>
                </div>
                <p class="category-description">Conecta con las personas importantes</p>
                <div class="tasks" id="tasks-comunicacion"></div>
                <button class="add-task-btn" onclick="showAddTaskModal('comunicacion')">+ A√±adir tarea</button>
            </div>

            <div class="category" data-category="estudiar">
                <div class="category-header">
                    <span class="category-icon">üìö</span>
                    <h2>Estudiar</h2>
                    <span class="category-progress" id="progress-estudiar">0/3</span>
                </div>
                <p class="category-description">Expande tus conocimientos</p>
                <div class="tasks" id="tasks-estudiar"></div>
                <button class="add-task-btn" onclick="showAddTaskModal('estudiar')">+ A√±adir tarea</button>
            </div>

            <div class="category" data-category="proyectos">
                <div class="category-header">
                    <span class="category-icon">üöÄ</span>
                    <h2>Proyectos</h2>
                    <span class="category-progress" id="progress-proyectos">0/3</span>
                </div>
                <p class="category-description">Crea y produce tus ideas</p>
                <div class="tasks" id="tasks-proyectos"></div>
                <button class="add-task-btn" onclick="showAddTaskModal('proyectos')">+ A√±adir tarea</button>
            </div>

            <div class="category" data-category="personal">
                <div class="category-header">
                    <span class="category-icon">üí™</span>
                    <h2>Tareas Personales</h2>
                    <span class="category-progress" id="progress-personal">0/3</span>
                </div>
                <p class="category-description">Cuida de ti mismo</p>
                <div class="tasks" id="tasks-personal"></div>
                <button class="add-task-btn" onclick="showAddTaskModal('personal')">+ A√±adir tarea</button>
            </div>
        </div>

        <!-- Block Time - Pomodoro -->
        <div class="block-time-section" id="block-time">
            <div class="block-time-header">
                <h2>‚è∞ Block Time</h2>
                <p>Usa la t√©cnica Pomodoro para mantener el enfoque</p>
            </div>
            
            <!-- Tarea Activa -->
            <div class="active-task-section">
                <h3>üéØ Tarea Activa</h3>
                <div class="active-task-container" id="activeTaskContainer">
                    <div class="no-active-task" id="noActiveTask">
                        <span class="task-icon">üìù</span>
                        <p>Selecciona una tarea para enfocarte durante el Block Time</p>
                        <button class="select-task-btn" onclick="showTaskSelector()">Seleccionar Tarea</button>
                    </div>
                    <div class="active-task-display" id="activeTaskDisplay" style="display: none;">
                        <div class="active-task-info">
                            <span class="active-task-category" id="activeTaskCategory">üí¨</span>
                            <div class="active-task-details">
                                <div class="active-task-name" id="activeTaskName">Nombre de la tarea</div>
                                <div class="active-task-points" id="activeTaskPoints">10 XP</div>
                                <div class="pomodoro-status" id="pomodoroStatus">‚è∞ Completa un pomodoro para finalizar</div>
                            </div>
                        </div>
                        <div class="active-task-actions">
                            <button class="complete-task-btn" onclick="window.game.completeActiveTask()" id="completeTaskBtn">‚úÖ Completar Tarea</button>
                            <button class="change-task-btn" onclick="showTaskSelector()">Cambiar</button>
                            <button class="restart-btn" onclick="restartFromLastIncomplete()" id="restartBtn" style="display: none;">üîÑ Reiniciar</button>
                            <button class="clear-task-btn" onclick="clearActiveTask()">Limpiar</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="pomodoro-container">
                <div class="timer-display">
                    <div class="timer-container">
                        <div class="timer-progress">
                            <svg class="progress-ring-svg" width="240" height="240">
                                <circle class="progress-ring-circle" cx="120" cy="120" r="110" fill="transparent" stroke="#e2e8f0" stroke-width="12"/>
                                <circle class="progress-ring-fill" cx="120" cy="120" r="110" fill="transparent" stroke="#6c63ff" stroke-width="12" stroke-linecap="round"/>
                                <circle class="progress-ring-glow" cx="120" cy="120" r="110" fill="transparent" stroke="#6c63ff" stroke-width="4" stroke-linecap="round" opacity="0.3"/>
                            </svg>
                        </div>
                        <div class="timer-circle">
                            <div class="timer-time" id="timerDisplay">25:00</div>
                            <div class="timer-label" id="timerLabel">Trabajo</div>
                            <div class="timer-percentage" id="timerPercentage">0%</div>
                        </div>
                    </div>
                </div>
                
                <div class="timer-controls">
                    <button class="timer-btn start-btn" id="startBtn" onclick="startPomodoroGlobal()">‚ñ∂Ô∏è Iniciar</button>
                    <button class="timer-btn pause-btn" id="pauseBtn" style="display: none;" onclick="pausePomodoroGlobal()">‚è∏Ô∏è Pausar</button>
                    <button class="timer-btn reset-btn" id="resetBtn" onclick="resetPomodoroGlobal()">üîÑ Reiniciar</button>
                </div>
                
                <div class="pomodoro-stats">
                    <div class="stat-box">
                        <span class="stat-icon">üçÖ</span>
                        <div class="stat-info">
                            <div class="stat-value" id="pomodorosToday">0</div>
                            <div class="stat-label">Pomodoros Hoy</div>
                        </div>
                    </div>
                    <div class="stat-box">
                        <span class="stat-icon">‚è±Ô∏è</span>
                        <div class="stat-info">
                            <div class="stat-value" id="focusTime">0h</div>
                            <div class="stat-label">Tiempo Enfocado</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="pomodoro-settings">
                <h3>‚öôÔ∏è Configuraci√≥n</h3>
                <div class="settings-grid">
                    <div class="setting-item">
                        <label for="workDuration">Tiempo de Trabajo (min):</label>
                        <select id="workDuration">
                            <option value="5">5 min</option>
                            <option value="15">15 min</option>
                            <option value="25" selected>25 min</option>
                            <option value="30">30 min</option>
                            <option value="45">45 min</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <label for="breakDuration">Descanso Corto (min):</label>
                        <select id="breakDuration">
                            <option value="3">3 min</option>
                            <option value="5" selected>5 min</option>
                            <option value="10">10 min</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <label for="longBreakDuration">Descanso Largo (min):</label>
                        <select id="longBreakDuration">
                            <option value="15" selected>15 min</option>
                            <option value="20">20 min</option>
                            <option value="30">30 min</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <label for="pomodorosUntilLongBreak">Pomodoros hasta descanso largo:</label>
                        <select id="pomodorosUntilLongBreak">
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4" selected>4</option>
                        </select>
                    </div>
                </div>
                
                <!-- Configuraci√≥n de Sonidos -->
                <div class="sound-settings">
                    <h4>üîä Notificaciones de Sonido</h4>
                    <div class="sound-settings-grid">
                        <div class="setting-item">
                            <label>
                                <input type="checkbox" id="soundNotificationsEnabled" checked>
                                Activar notificaciones de sonido
                            </label>
                        </div>
                        <div class="setting-item">
                            <label for="workCompleteSound">Sonido al completar trabajo:</label>
                            <select id="workCompleteSound">
                                <option value="bell" selected>üîî Campana</option>
                                <option value="chime">üéµ Campanilla</option>
                                <option value="gong">üîî Gong</option>
                                <option value="beep">üì¢ Beep</option>
                                <option value="ding">üîî Ding</option>
                            </select>
                        </div>
                        <div class="setting-item">
                            <label for="breakStartSound">Sonido al iniciar descanso:</label>
                            <select id="breakStartSound">
                                <option value="bell">üîî Campana</option>
                                <option value="chime" selected>üéµ Campanilla</option>
                                <option value="gong">üîî Gong</option>
                                <option value="beep">üì¢ Beep</option>
                                <option value="ding">üîî Ding</option>
                            </select>
                        </div>
                        <div class="setting-item">
                            <label for="longBreakStartSound">Sonido al iniciar descanso largo:</label>
                            <select id="longBreakStartSound">
                                <option value="bell">üîî Campana</option>
                                <option value="chime">üéµ Campanilla</option>
                                <option value="gong" selected>üîî Gong</option>
                                <option value="beep">üì¢ Beep</option>
                                <option value="ding">üîî Ding</option>
                            </select>
                        </div>
                        <div class="setting-item">
                            <button id="testSoundBtn" class="test-sound-btn">üéµ Probar Sonidos</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Estad√≠sticas Diarias -->
        <div class="daily-stats-section" id="daily-stats">
            <h2>üìä Estad√≠sticas de Hoy</h2>
            <div class="daily-stats-grid">
                <div class="daily-stat-card">
                    <div class="stat-icon">‚úÖ</div>
                    <div class="stat-content">
                        <div class="stat-value" id="todayTasks">0</div>
                        <div class="stat-label">Tareas Completadas</div>
                        <div class="stat-progress">
                            <div class="progress-bar-small">
                                <div class="progress-fill-small" id="tasksProgress"></div>
                            </div>
                            <span class="progress-text-small" id="tasksProgressText">0/5</span>
                        </div>
                    </div>
                </div>
                
                <div class="daily-stat-card">
                    <div class="stat-icon">üçÖ</div>
                    <div class="stat-content">
                        <div class="stat-value" id="todayPomodoros">0</div>
                        <div class="stat-label">Pomodoros</div>
                        <div class="stat-progress">
                            <div class="progress-bar-small">
                                <div class="progress-fill-small" id="pomodorosProgress"></div>
                            </div>
                            <span class="progress-text-small" id="pomodorosProgressText">0/4</span>
                        </div>
                    </div>
                </div>
                
                <div class="daily-stat-card">
                    <div class="stat-icon">‚è±Ô∏è</div>
                    <div class="stat-content">
                        <div class="stat-value" id="todayFocusTime">0m</div>
                        <div class="stat-label">Tiempo Enfocado</div>
                        <div class="stat-progress">
                            <div class="progress-bar-small">
                                <div class="progress-fill-small" id="focusProgress"></div>
                            </div>
                            <span class="progress-text-small" id="focusProgressText">0/120m</span>
                        </div>
                    </div>
                </div>
                
                <div class="daily-stat-card">
                    <div class="stat-icon">üéØ</div>
                    <div class="stat-content">
                        <div class="stat-value" id="todayEfficiency">0%</div>
                        <div class="stat-label">Eficiencia</div>
                        <div class="stat-progress">
                            <div class="progress-bar-small">
                                <div class="progress-fill-small" id="efficiencyProgress"></div>
                            </div>
                            <span class="progress-text-small" id="efficiencyProgressText">0/100%</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Configuraci√≥n de Metas -->
        <div class="goals-config-section" id="goals">
            <h2>üéØ Configuraci√≥n de Metas Diarias</h2>
            <div class="goals-config-grid">
                <div class="goal-config-card">
                    <div class="goal-header">
                        <span class="goal-icon">‚úÖ</span>
                        <h3>Metas de Tareas</h3>
                    </div>
                    <div class="goal-settings">
                        <div class="setting-item">
                            <label for="taskGoal">Meta diaria de tareas:</label>
                            <input type="number" id="taskGoal" min="1" max="20" value="5">
                        </div>
                        <div class="goal-achievements">
                            <div class="achievement-badge" id="taskAchievement">
                                <span class="achievement-icon">üéØ</span>
                                <span class="achievement-text">Meta: 5 tareas</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="goal-config-card">
                    <div class="goal-header">
                        <span class="goal-icon">üçÖ</span>
                        <h3>Metas de Pomodoros</h3>
                    </div>
                    <div class="goal-settings">
                        <div class="setting-item">
                            <label for="pomodoroGoal">Meta diaria de pomodoros:</label>
                            <input type="number" id="pomodoroGoal" min="1" max="20" value="4">
                        </div>
                        <div class="goal-achievements">
                            <div class="achievement-badge" id="pomodoroAchievement">
                                <span class="achievement-icon">üéØ</span>
                                <span class="achievement-text">Meta: 4 pomodoros</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="goal-config-card">
                    <div class="goal-header">
                        <span class="goal-icon">‚è±Ô∏è</span>
                        <h3>Metas de Tiempo</h3>
                    </div>
                    <div class="goal-settings">
                        <div class="setting-item">
                            <label for="timeGoal">Meta diaria de tiempo (minutos):</label>
                            <input type="number" id="timeGoal" min="15" max="480" value="120">
                        </div>
                        <div class="goal-achievements">
                            <div class="achievement-badge" id="timeAchievement">
                                <span class="achievement-icon">üéØ</span>
                                <span class="achievement-text">Meta: 120 minutos</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="goals-summary">
                <h3>üèÜ Resumen de Logros de Hoy</h3>
                <div class="achievements-grid">
                    <div class="achievement-item" id="taskMultiplier">
                        <span class="achievement-icon">‚úÖ</span>
                        <span class="achievement-label">Tareas</span>
                        <span class="achievement-value">0x</span>
                    </div>
                    <div class="achievement-item" id="pomodoroMultiplier">
                        <span class="achievement-icon">üçÖ</span>
                        <span class="achievement-label">Pomodoros</span>
                        <span class="achievement-value">0x</span>
                    </div>
                    <div class="achievement-item" id="timeMultiplier">
                        <span class="achievement-icon">‚è±Ô∏è</span>
                        <span class="achievement-label">Tiempo</span>
                        <span class="achievement-value">0x</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Estad√≠sticas Hist√≥ricas -->
        <div class="stats-history-section" id="stats-history">
            <h2>üìä Estad√≠sticas Hist√≥ricas</h2>
            <div class="stats-tabs">
                <button class="tab-btn active" onclick="showStatsTab('week')">Semana</button>
                <button class="tab-btn" onclick="showStatsTab('month')">Mes</button>
            </div>
            <div class="stats-content">
                <div class="stats-tab" id="weekStats">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <span class="stat-icon">‚úÖ</span>
                            <div class="stat-info">
                                <div class="stat-value" id="weekTasks">0</div>
                                <div class="stat-label">Tareas Esta Semana</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <span class="stat-icon">üçÖ</span>
                            <div class="stat-info">
                                <div class="stat-value" id="weekPomodoros">0</div>
                                <div class="stat-label">Pomodoros Esta Semana</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <span class="stat-icon">‚è±Ô∏è</span>
                            <div class="stat-info">
                                <div class="stat-value" id="weekFocusTime">0h</div>
                                <div class="stat-label">Tiempo Enfocado</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <span class="stat-icon">üìà</span>
                            <div class="stat-info">
                                <div class="stat-value" id="weekAverage">0</div>
                                <div class="stat-label">Promedio Diario</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="stats-tab" id="monthStats" style="display: none;">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <span class="stat-icon">‚úÖ</span>
                            <div class="stat-info">
                                <div class="stat-value" id="monthTasks">0</div>
                                <div class="stat-label">Tareas Este Mes</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <span class="stat-icon">üçÖ</span>
                            <div class="stat-info">
                                <div class="stat-value" id="monthPomodoros">0</div>
                                <div class="stat-label">Pomodoros Este Mes</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <span class="stat-icon">‚è±Ô∏è</span>
                            <div class="stat-info">
                                <div class="stat-value" id="monthFocusTime">0h</div>
                                <div class="stat-label">Tiempo Enfocado</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <span class="stat-icon">üìà</span>
                            <div class="stat-info">
                                <div class="stat-value" id="monthAverage">0</div>
                                <div class="stat-label">Promedio Diario</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Historial de Tareas -->
        <div class="stats-history-section" id="history">
            <h2>üìà Historial de Tareas</h2>
            <div class="history-tabs">
                <button class="history-tab-btn active" onclick="showHistoryTab('daily')">üìÖ D√≠a</button>
                <button class="history-tab-btn" onclick="showHistoryTab('weekly')">üìä Semana</button>
                <button class="history-tab-btn" onclick="showHistoryTab('monthly')">üìÜ Mes</button>
            </div>
            <div class="history-content">
                <!-- El contenido se genera din√°micamente por JavaScript -->
            </div>
        </div>

        <!-- Logros recientes -->
        <div class="achievements-section">
            <h2>üèÜ Logros Desbloqueados</h2>
            <div class="achievements" id="achievements"></div>
        </div>

        <!-- Secci√≥n de administraci√≥n -->
        <div class="admin-section">
            <h2>‚öôÔ∏è Administraci√≥n</h2>
            <div class="admin-content">
                <div class="admin-card">
                    <div class="admin-header">
                        <span class="admin-icon">üóëÔ∏è</span>
                        <h3>Limpiar Datos</h3>
                    </div>
                    <div class="admin-description">
                        <p>Elimina todos los datos de la aplicaci√≥n:</p>
                        <ul class="admin-list">
                            <li>üìä Puntos y nivel</li>
                            <li>üìù Todas las tareas</li>
                            <li>üçÖ Progreso de pomodoros</li>
                            <li>üìà Estad√≠sticas hist√≥ricas</li>
                            <li>üèÜ Logros desbloqueados</li>
                        </ul>
                        <p class="admin-warning">‚ö†Ô∏è Esta acci√≥n no se puede deshacer</p>
                    </div>
                    <button class="admin-clear-btn" onclick="showClearDataModal()">
                        <span class="btn-icon">üóëÔ∏è</span>
                        <span class="btn-text">Limpiar Todos los Datos</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para a√±adir tareas -->
    <div class="modal" id="addTaskModal">
        <div class="modal-content">
            <span class="close" onclick="closeAddTaskModal()">&times;</span>
            <h2>‚ûï Nueva Tarea</h2>
            <form id="addTaskForm">
                <input type="hidden" id="taskCategory">
                <div class="form-group">
                    <label for="taskName">Nombre de la tarea:</label>
                    <input type="text" id="taskName" required placeholder="Ej: Llamar a mam√°">
                </div>
                <div class="form-group">
                    <label for="taskDifficulty">Dificultad:</label>
                    <select id="taskDifficulty">
                        <option value="5">F√°cil (5 XP)</option>
                        <option value="10" selected>Media (10 XP)</option>
                        <option value="20">Dif√≠cil (20 XP)</option>
                    </select>
                </div>
                <button type="submit" class="submit-btn">Crear Tarea</button>
            </form>
        </div>
    </div>

    <!-- Modal de celebraci√≥n -->
    <div class="celebration-modal" id="celebrationModal">
        <div class="celebration-content">
            <div class="celebration-icon">üéâ</div>
            <h2 id="celebrationTitle">¬°Incre√≠ble!</h2>
            <p id="celebrationMessage">¬°Has completado una tarea!</p>
            <div class="points-earned" id="pointsEarned">+10 XP</div>
            <button class="celebration-btn" onclick="closeCelebration()">¬°Continuar!</button>
        </div>
    </div>

    <!-- Modal para seleccionar tarea activa -->
    <div class="modal" id="taskSelectorModal">
        <div class="modal-content">
            <span class="close" onclick="closeTaskSelector()">&times;</span>
            <h2>üéØ Seleccionar Tarea Activa</h2>
            <p>Elige una tarea para enfocarte durante el Block Time</p>
            
            <div class="task-selector-categories">
                <div class="task-category-section" data-category="comunicacion">
                    <h3>üí¨ Comunicaci√≥n</h3>
                    <div class="task-list" id="selector-tasks-comunicacion"></div>
                </div>
                
                <div class="task-category-section" data-category="estudiar">
                    <h3>üìö Estudiar</h3>
                    <div class="task-list" id="selector-tasks-estudiar"></div>
                </div>
                
                <div class="task-category-section" data-category="proyectos">
                    <h3>üöÄ Proyectos</h3>
                    <div class="task-list" id="selector-tasks-proyectos"></div>
                </div>
                
                <div class="task-category-section" data-category="personal">
                    <h3>üí™ Personal</h3>
                    <div class="task-list" id="selector-tasks-personal"></div>
                </div>
            </div>
            
            <div class="no-tasks-message" id="noTasksMessage" style="display: none;">
                <span class="no-tasks-icon">üìù</span>
                <p>No tienes tareas pendientes. ¬°A√±ade algunas tareas primero!</p>
                <button class="add-tasks-btn" onclick="closeTaskSelector(); showAddTaskModal('comunicacion')">A√±adir Tareas</button>
            </div>
        </div>
    </div>


    <script src="{{ "js/daily-system.js" | relURL }}"></script>
    <script src="{{ "js/app.js" | relURL }}"></script>
    <script src="{{ "js/debug.js" | relURL }}"></script>
    
    <!-- Service Worker y Notificaciones Push -->
    <script>
        // Registrar Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', async () => {
                try {
                    const registration = await navigator.serviceWorker.register('/sw.js');
                    console.log('‚úÖ Service Worker registrado exitosamente:', registration);
                    
                    // Verificar si hay actualizaciones
                    registration.addEventListener('updatefound', () => {
                        const newWorker = registration.installing;
                        newWorker.addEventListener('statechange', () => {
                            if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                // Nueva versi√≥n disponible
                                if (confirm('¬°Nueva versi√≥n de TaskQuest disponible! ¬øRecargar para actualizar?')) {
                                    window.location.reload();
                                }
                            }
                        });
                    });
                    
                } catch (error) {
                    console.error('‚ùå Error al registrar Service Worker:', error);
                }
            });
        }

        // Solicitar permisos de notificaci√≥n (optimizado para iPhone)
        async function requestNotificationPermission() {
            if (!('Notification' in window)) {
                console.log('‚ùå Este navegador no soporta notificaciones');
                return false;
            }

            if (Notification.permission === 'granted') {
                console.log('‚úÖ Permisos de notificaci√≥n ya concedidos');
                return true;
            }

            if (Notification.permission !== 'denied') {
                // En iPhone, es importante solicitar permisos despu√©s de una interacci√≥n del usuario
                try {
                    const permission = await Notification.requestPermission();
                    if (permission === 'granted') {
                        console.log('‚úÖ Permisos de notificaci√≥n concedidos');
                        return true;
                    } else if (permission === 'denied') {
                        console.log('‚ùå Permisos de notificaci√≥n denegados por el usuario');
                        // Mostrar instrucciones para iPhone
                        showIOSNotificationInstructions();
                    }
                } catch (error) {
                    console.error('‚ùå Error al solicitar permisos:', error);
                    showIOSNotificationInstructions();
                }
            }

            console.log('‚ùå Permisos de notificaci√≥n denegados');
            return false;
        }

        // Mostrar instrucciones espec√≠ficas para iPhone
        function showIOSNotificationInstructions() {
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
            if (isIOS) {
                const modal = document.createElement('div');
                modal.className = 'modal ios-instructions-modal';
                modal.innerHTML = `
                    <div class="modal-content ios-instructions-content">
                        <div class="ios-header">
                            <span class="ios-icon">üì±</span>
                            <h2>Configurar Notificaciones en iPhone</h2>
                        </div>
                        <div class="ios-body">
                            <p>Para recibir notificaciones de TaskQuest en tu iPhone:</p>
                            <ol class="ios-steps">
                                <li>Ve a <strong>Configuraci√≥n</strong> ‚Üí <strong>Notificaciones</strong></li>
                                <li>Busca <strong>TaskQuest</strong> en la lista</li>
                                <li>Activa <strong>Permitir notificaciones</strong></li>
                                <li>Configura los tipos de notificaciones que deseas</li>
                            </ol>
                            <p class="ios-note">üí° Las notificaciones funcionar√°n incluso con el tel√©fono apagado una vez configuradas.</p>
                        </div>
                        <div class="ios-actions">
                            <button class="ios-btn" onclick="this.parentElement.parentElement.parentElement.remove()">
                                Entendido
                            </button>
                        </div>
                    </div>
                `;
                
                // A√±adir estilos
                modal.style.cssText = `
                    position: fixed;
                    z-index: 10000;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0, 0, 0, 0.7);
                    backdrop-filter: blur(8px);
                `;
                
                document.body.appendChild(modal);
                
                // Auto-cerrar despu√©s de 15 segundos
                setTimeout(() => {
                    if (modal.parentNode) {
                        modal.remove();
                    }
                }, 15000);
            }
        }

        // Mostrar banner de instalaci√≥n PWA
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            
            // Mostrar banner de instalaci√≥n
            const installBanner = document.createElement('div');
            installBanner.className = 'install-banner';
            installBanner.innerHTML = `
                <div class="install-banner-content">
                    <span class="install-icon">üì±</span>
                    <div class="install-text">
                        <strong>Instalar TaskQuest</strong>
                        <p>Para notificaciones incluso con el tel√©fono apagado</p>
                    </div>
                    <button class="install-btn" onclick="installPWA()">Instalar</button>
                    <button class="install-close" onclick="this.parentElement.parentElement.remove()">√ó</button>
                </div>
            `;
            
            // A√±adir estilos
            installBanner.style.cssText = `
                position: fixed;
                bottom: 20px;
                left: 20px;
                right: 20px;
                background: linear-gradient(135deg, #6c63ff, #4f46e5);
                color: white;
                border-radius: 12px;
                padding: 16px;
                box-shadow: 0 8px 32px rgba(108, 99, 255, 0.3);
                z-index: 10000;
                animation: slideUp 0.3s ease;
            `;
            
            document.body.appendChild(installBanner);
            
            // Auto-ocultar despu√©s de 10 segundos
            setTimeout(() => {
                if (installBanner.parentNode) {
                    installBanner.remove();
                }
            }, 10000);
        });

        // Funci√≥n para instalar PWA
        async function installPWA() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                console.log(`PWA instalaci√≥n: ${outcome}`);
                deferredPrompt = null;
                
                // Remover banner
                const banner = document.querySelector('.install-banner');
                if (banner) banner.remove();
            }
        }

        // Inicializar notificaciones cuando la app est√© lista
        document.addEventListener('DOMContentLoaded', async () => {
            // Esperar a que el juego se inicialice
            setTimeout(async () => {
                if (window.game) {
                    // Solicitar permisos de notificaci√≥n
                    const hasPermission = await requestNotificationPermission();
                    
                    if (hasPermission) {
                        // Configurar notificaciones en el juego
                        window.game.setupPushNotifications();
                    }
                }
            }, 2000);
        });

        // Manejar notificaciones cuando la app vuelve a estar activa
        document.addEventListener('visibilitychange', () => {
            if (!document.hidden && window.game) {
                // La app volvi√≥ a estar activa, sincronizar datos
                window.game.syncWithServiceWorker();
            }
        });
    </script>
    
    <style>
        @keyframes slideUp {
            from {
                transform: translateY(100px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .install-banner-content {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .install-icon {
            font-size: 24px;
        }
        
        .install-text {
            flex: 1;
        }
        
        .install-text strong {
            display: block;
            font-size: 16px;
            margin-bottom: 4px;
        }
        
        .install-text p {
            margin: 0;
            font-size: 14px;
            opacity: 0.9;
        }
        
        .install-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .install-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }
        
        .install-close {
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: background 0.2s ease;
        }
        
        .install-close:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        /* Estilos para instrucciones de iPhone */
        .ios-instructions-content {
            background: var(--card-bg);
            margin: 10% auto;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            position: relative;
            animation: slideDown 0.3s ease;
        }
        
        .ios-header {
            text-align: center;
            margin-bottom: 25px;
        }
        
        .ios-icon {
            font-size: 48px;
            display: block;
            margin-bottom: 15px;
        }
        
        .ios-header h2 {
            font-size: 22px;
            color: var(--text-primary);
            margin: 0;
        }
        
        .ios-body {
            margin-bottom: 25px;
        }
        
        .ios-body p {
            color: var(--text-secondary);
            margin-bottom: 15px;
        }
        
        .ios-steps {
            color: var(--text-primary);
            padding-left: 20px;
        }
        
        .ios-steps li {
            margin-bottom: 10px;
            line-height: 1.5;
        }
        
        .ios-steps strong {
            color: var(--primary);
        }
        
        .ios-note {
            background: var(--background-alt);
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid var(--primary);
            font-style: italic;
            margin-top: 20px;
        }
        
        .ios-actions {
            text-align: center;
        }
        
        .ios-btn {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Poppins', sans-serif;
        }
        
        .ios-btn:hover {
            transform: scale(1.05);
            box-shadow: var(--shadow-lg);
        }
    </style>
</body>
</html>
